(e=>{let t,n,s,r,i,a,l,o,c,d;const m=[];let u,h=Promise.resolve();function v(e){return e?(o.addEventListener("keypress",f),o.addEventListener("submit",g),o.addEventListener("drop",k),n.addEventListener("click",C),s.addEventListener("click",w),r.addEventListener("click",y),c&&(c.addEventListener("emoji-click",p),d.addEventListener("click",L)),Chat.show().then(()=>{Utils.sendEvent("chatView:shown"),M(),i.focus()})):(o.removeEventListener("keypress",f),n.removeEventListener("click",C),s.removeEventListener("click",w),r.removeEventListener("click",y),o.removeEventListener("drop",k),c&&(c.removeEventListener("emoji-click",p),d.removeEventListener("click",L)),Chat.hide().then(()=>{Utils.sendEvent("chatView:hidden")}))}function E(e){u={incomingMessage:{name:"chatController:incomingMessage",handler(e){const t=e.detail.data;!function(e){const t=HTMLElems.createElementAt(l,"li"),n=HTMLElems.createElementAt(t,"p");if(otHelper.isMyself({connectionId:e.senderId}))t.classList.add("yourself");else{let t=m.indexOf(e.senderId);-1===t&&(t=m.push(e.senderId)-1);const s=t.toString().slice(-1);n.data("participant-number",s)}const s=e.time.toLowerCase();HTMLElems.createElementAt(n,"span",null,s).classList.add("time"),HTMLElems.createElementAt(n,"span",null,e.sender||e.userName).classList.add("sender"),T(n,e.text),M()}(t),h.then(()=>Chat.visible).then(e=>{e||Utils.sendEvent("chatView:unreadMessage",{data:t})})}},presenceEvent:{name:"chatController:presenceEvent",handler(e){!function(e){const t=(e.time||Utils.getCurrentTime()).toLowerCase(),n=HTMLElems.createElementAt(l,"li");n.classList.add("event");const s=e.sender||e.userName,r=`${t} - ${s} ${e.text}`;T(n,r),M()}(e.detail)}},messageDelivered:{name:"chatController:messageDelivered",handler(){i.value=""}},chatVisibility:{name:"roomView:chatVisibility",handler(e){h=v(e.detail)},couldBeChanged:!0}},Array.isArray(e)&&e.forEach(e=>{const t=u[e.type];t&&t.couldBeChanged&&(t.name=e.name)}),Utils.addHandlers(u)}const p=e=>i.value+=" "+e.detail.unicode+" ",L=e=>{e.preventDefault(),"none"===c.style.display?c.style.display="block":c.style.display="none"},y=e=>{e.preventDefault(),i.value.trim().length&&(void 0!==window.orientation?document.activeElement.blur():i.focus(),Utils.sendEvent("chatView:outgoingMessage",{sender:t,time:Utils.getCurrentTime(),text:i.value.trim()}),c&&(c.style.display="none"))},f=((e,t)=>{let n;if(window.vent)n=window.event.keyCode;else{if(!t)return!0;n=t.which}return 13!==n||(!0===t.shiftKey||(y(t),!1))}).bind(void 0,i),g=e=>(e.preventDefault(),!1),C=e=>{e.preventDefault(),e.stopImmediatePropagation(),h=v(!1)},w=()=>{Chat.isCollapsed()?Chat.expand():Chat.collapse()},k=e=>(e.preventDefault(),e.stopPropagation(),!1);function T(e,t){const n=TextProcessor.parse(t),s=HTMLElems.createElementAt(e,"p");n.forEach(e=>{switch(e.type){case TextProcessor.TYPE.URL:HTMLElems.createElementAt(s,"a",{href:e.value,target:"_blank"},e.value);break;default:HTMLElems.addText(s,e.value)}})}function M(){a.scrollTop=a.scrollHeight}const x={init:function(e,m){return LazyLoader.dependencyLoad(["/js/helpers/textProcessor.js","/js/components/chat.js"]).then(()=>{!function(){const e=document.getElementById("chat");s=e.querySelector("header"),n=e.querySelector("#closeChat"),r=e.querySelector("#sendTxt"),i=e.querySelector("#msgText"),a=e.querySelector("#chatMsgs"),l=a.querySelector("ul"),o=e.querySelector("#chatForm"),c=document.querySelector("emoji-picker"),d=e.querySelector("#addEmoji")}(),t=e,Chat.init(),E(m)})}};e.ChatView=x})(this);
 //# sourceMappingURL= chatView.min.js.map