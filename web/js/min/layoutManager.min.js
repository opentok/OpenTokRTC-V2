(t=>{let e=null,n=null,o=null;const a={};let r;const i=window.localStorage,l={float:!0,f2f_horizontal:!0,f2f_vertical:!0},u={grid:!0,hangout_horizontal:!0,hangout_vertical:!0};function c(t){return Object.getPrototypeOf(n)===t.prototype}const d={layout(t){e=t.detail.type,i.setItem("opentokrtc-layout",e),h()},itemSelected(t){g()&&c(Grid)&&(e="hangout_vertical",h(t.detail.item))},emptyStage(){e="grid",h()}};function s(t=!1){if(window.matchMedia("screen and (min-device-width : 320px) and (max-device-width : 1024px) and (orientation : landscape)").matches)return t?"hangout_vertical":"f2f_vertical";if(window.matchMedia("screen and (max-width: 480px) and (orientation : portrait)").matches)return t?"hangout_horizontal":"f2f_horizontal";let n=null;return e!==i.getItem("opentokrtc-default")&&(n=i.getItem("opentokrtc-default")),t?"hangout_vertical":n}function m(){const t=null!=i.getItem("opentokrtc-screenshare");e=function(t,e){return e||f()<=2?t:"grid"}(s(t),t),h()}function f(){return Object.keys(a).length}function g(){return f()>2}function h(t){const i=function(){let t=null;return t=f()>2?u[e]?r[e]:Grid:l[e]?r[e]:Float,t}();n&&c(i)||(n&&n.destroy(),n=new i(o,a,t),Utils.sendEvent("layoutManager:layoutChanged")),n.rearrange(),Utils.sendEvent("layoutManager:availableLayouts",{layouts:g()?u:l})}t.LayoutManager={init:function(n,l){r={grid:Grid,float:Float,f2f_horizontal:F2FHorizontal,f2f_vertical:F2FVertical,hangout_horizontal:HangoutHorizontal,hangout_vertical:HangoutVertical},o=document.querySelector(n),LayoutView.init(o),ItemsHandler.init(o,a),Utils.addEventsHandlers("layoutMenuView:",d,t),Utils.addEventsHandlers("layoutView:",d,t),Utils.addEventsHandlers("hangout:",d,t),i.setItem("opentokrtc-default",e);const u=window.matchMedia("screen and (max-width: 480px) and (orientation : portrait)");return u.matches&&m(),u.addListener(m),l?LazyLoader.load(["/js/layoutViewport.js","/css/hangoutScroll.css"]).then(()=>{LayoutViewport.init(o.querySelector(".tc-list ul"),".stream")}):Promise.resolve()},append:function(t,n){const o=LayoutView.append(t,n);return a[t]=o,!function(t){return Utils.isScreen(t)&&g()&&!(c(HangoutHorizontal)||c(HangoutVertical))}(o)?h():(e=s(!0),i.setItem("opentokrtc-screenshare",t),h(o)),Utils.sendEvent("layoutManager:itemAdded",{item:o}),o.querySelector(".opentok-stream-container")},remove:function(t){const e=a[t];e&&(t===i.getItem("opentokrtc-screenshare")&&i.removeItem("opentokrtc-screenshare"),LayoutView.remove(e),delete a[t],Utils.sendEvent("layoutManager:itemDeleted",{item:e}),m())},removeAll:function(){LayoutView.removeAll()},getItemById:function(t){return a[t]}}})(this);