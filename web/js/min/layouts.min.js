const LayoutBase=function(t,e,a){this.items=e,this.container=t,t.data("currentLayoutType",a)};LayoutBase.prototype={rearrange(){const t=this.features;return Object.keys(this.items).forEach((function(e){const a=this.items[e].style;Object.keys(t).forEach(e=>{a[e]=t[e]})}),this),Utils.sendEvent("hangout:rearranged"),this},get features(){return{}},get total(){return Object.keys(this.items).length},destroy(){this.container=null}};const Grid=function(t,e){LayoutBase.call(this,t,e,"grid")};(Grid.prototype=Object.create(LayoutBase.prototype,{features:{configurable:!1,get(){const t=this.total,e=Math.ceil(Math.sqrt(t));return{width:100/e+"%",height:100/Math.ceil(t/e)+"%"}}}})).constructor=Grid;const Float=function(t,e){LayoutBase.call(this,t,e,"float"),this.addDraggableFeature()};(Float.prototype=Object.create(LayoutBase.prototype,{features:{configurable:!1,get:()=>({width:"100%",height:"100%"})},publisher:{configurable:!1,get(){return this.items.publisher}}})).constructor=Float,Float.prototype.addDraggableFeature=function(){!this.addedDraggableFeature&&this.publisher&&(this.addedDraggableFeature=!0,Utils.getDraggable().then(t=>{t.on(this.publisher)}))},Float.prototype.rearrange=function(...t){LayoutBase.prototype.rearrange.apply(this,t),this.addDraggableFeature()},Float.prototype.destroy=function(){Utils.getDraggable().then(function(t){t.off(this.publisher),LayoutBase.prototype.destroy.apply(this,arguments)}.bind(this))};const F2FHorizontal=function(t,e){LayoutBase.call(this,t,e,"f2f_horizontal")};(F2FHorizontal.prototype=Object.create(LayoutBase.prototype,{features:{configurable:!1,get(){return{width:"100%",height:100/this.total+"%"}}}})).constructor=F2FHorizontal;const F2FVertical=function(t,e){LayoutBase.call(this,t,e,"f2f_vertical")};(F2FVertical.prototype=Object.create(LayoutBase.prototype,{features:{configurable:!1,get(){return{width:100/this.total+"%",height:"100%"}}}})).constructor=F2FVertical;const Hangout=function(t,e,a,o){LayoutBase.call(this,t,e,o),Object.keys(this.handlers).forEach((function(t){window.addEventListener(t,this)}),this),this.sanitize(!!a),a?this.putItemOnStage(a):this.totalOnStage||this.putItemOnStage(this.getRandomItem()),this.updateTotalOnStage()};Hangout.getAttributeName=t=>`onStage${t.charAt(0).toUpperCase()}${t.slice(1)}`,Hangout.getItemType=t=>{let e=null;switch(t.data("streamType")){case"camera":case"publisher":e="camera";break;default:e="screen"}return e},Hangout.getItemId=t=>t.data("id"),Hangout.stageTypeDescriptors=["camera","screen"].map(t=>({type:t,attrName:Hangout.getAttributeName(t)})),(Hangout.prototype=Object.create(LayoutBase.prototype,{stageIds:{configurable:!1,get(){const t={};return Hangout.stageTypeDescriptors.forEach((function(e){const a=this.container.data(e.attrName);a&&(t[e.type]=a)}),this),t},set(t){t=t||{},Hangout.stageTypeDescriptors.forEach((function(e){t[e.type]?this.container.data(e.attrName,t[e.type]):this.container.data(e.attrName,null)}),this)}},totalOnStage:{configurable:!1,get(){return Object.keys(this.stageIds).length}},totalOnStrip:{configurable:!1,get(){return this.total-this.totalOnStage}}})).constructor=Hangout,Hangout.prototype.handlers={"layoutView:itemSelected":function(t){const e=t.detail.item;this.isOnStage(e)?this.removeCurrentItemFromStage("camera"===Hangout.getItemType(e)?"screen":"camera"):this.putItemOnStage(e),this.updateTotalOnStage()},"layoutManager:itemDeleted":function(t){const e=t.detail.item;this.isOnStage(e)&&(this.removeItemFromStage(e).updateTotalOnStage(),!this.totalOnStage&&Utils.sendEvent("hangout:emptyStage"))},"layoutManager:itemAdded":function(t){const e=t.detail.item;"screen"!==Hangout.getItemType(e)||this.stageIds.screen||this.putItemOnStage(e).updateTotalOnStage()}},Hangout.prototype.handleEvent=function(t){this.handlers[t.type].call(this,t)},Hangout.prototype.putItemOnStage=function(t){if(!t)return this;const e=Hangout.getItemType(t);return this.removeCurrentItemFromStage(e).putStageId(t),t.classList.add("on-stage"),"screen"===e&&Utils.sendEvent("hangout:screenOnStage",{status:"on"}),this},Hangout.prototype.getRandomItem=function(){return this.items[Object.keys(this.items).find(t=>"publisher"!==t)]},Hangout.prototype.removeCurrentItemFromStage=function(t){const e=this.items[this.stageIds[t]];return this.removeItemFromStage(e)},Hangout.prototype.removeItemFromStage=function(t){return t&&(this.removeStageId(t),t.classList.remove("on-stage"),"screen"===Hangout.getItemType(t)&&Utils.sendEvent("hangout:screenOnStage",{status:"off"})),this},Hangout.prototype.isOnStage=t=>t.classList.contains("on-stage"),Hangout.prototype.sanitize=function(t){const e={};if(Array.prototype.forEach.call(this.container.querySelectorAll(".on-stage"),t=>{t.classList.remove("on-stage")}),!t){const t=this.stageIds;Object.keys(t).forEach((function(a){const o=t[a],n=this.items[o];n&&(n.classList.add("on-stage"),e[a]=o)}),this)}return this.stageIds=e,this},Hangout.prototype.putStageId=function(t){const e=this.stageIds;return e[Hangout.getItemType(t)]=Hangout.getItemId(t),this.stageIds=e,this},Hangout.prototype.removeStageId=function(t){const e=this.stageIds;return delete e[Hangout.getItemType(t)],this.stageIds=e,this},Hangout.prototype.updateTotalOnStage=function(){return this.container.data("totalOnStage",this.totalOnStage),this.rearrange()},Hangout.prototype.destroy=function(...t){Object.keys(this.handlers).forEach((function(t){window.removeEventListener(t,this)}),this),LayoutBase.prototype.destroy.apply(this,t)};const HangoutHorizontal=function(t,e,a){Hangout.call(this,t,e,a,"hangout_horizontal")};(HangoutHorizontal.prototype=Object.create(Hangout.prototype,{features:{configurable:!1,get(){return{width:100/this.totalOnStrip+"%",height:"100%"}}}})).constructor=HangoutHorizontal;const HangoutVertical=function(t,e,a){Hangout.call(this,t,e,a,"hangout_vertical")};(HangoutVertical.prototype=Object.create(Hangout.prototype,{features:{configurable:!1,get(){return{width:"100%",height:100/this.totalOnStrip+"%"}}}})).constructor=HangoutVertical;